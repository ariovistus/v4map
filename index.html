<!DOCTYPE html>
<html>
	<head>
        <style>
            .coord-display {
                position: fixed; 
                width: 90px; 
                height: 25px; 
                background-color: blue; 
                color: white;
            }
        </style>

        <script src='./svg.js' type='text/javascript'></script>
        <script src='./canyonlands.js' type='text/javascript'></script>
        <script src='./coastline.js' type='text/javascript'></script>
        <script type='text/javascript'>
            //// data!

            var crater = {
                title: "Volcanic Crater",
                world_coords: [
                    [-24, -70],
                    [-49, -45],
                    [-20, 0], // fake!!!
                    [0, 50], // fake!!!
                    [150, 0], // fake!!!
                    [131, -75],
                    [58, -54],
                    [45, -56],
                    [-24, -70]
                ],
                fill: "gray",
                stroke: {color: 'brown', width: '1px'}
            };

            var blue_plants = [
                [-51, -516],
                [680, 90],
                [164, 582],
                [-557, 152],
                [-360, 120],
                [604, -511],
            ];

            var forage_plants = [
                [-346, -206],
                [-442, -401],
            ];

            var redwood_lake = {
                title: "Redwood Lake",
                world_coords: [
                    [-324, 264],
                    [-317, 265],
                    [-314, 272],
                    [-315, 274],
                    [-320, 273],
                    [-324, 268],
                    [-324, 264],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}
            };


            var redwood_cliff3 = {
                world_coords: [
                    [-297, -10],
                    [-289, 22],
                    [-293, 82],
                    [-297, 103],
                    [-316, 121],
                    [-319, 117],
                ],
                fill: "none",
                stroke: {color: 'gray', width: '1px'}
            };

            var swamp_lake2 = {
                title: "Swamp Lake",
                world_coords: [
                    [-445, -39],
                    [-450, -39],
                    [-451, -41],
                    [-451, -44],
                    [-446, -46],
                    [-451, -49],
                    [-445, -62],
                    [-441, -46],
                    [-445, -39],
                    [-450, -39],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}
            };

            var big_lake = {
                title: "Big Lake",
                world_coords: [
                    [-574, 129],
                    [-575, 132],
                    [-569, 143],
                    [-574, 147],
                    [-577, 153],
                    [-582, 155],
                    [-585, 154],
                    [-590, 151],
                    [-593, 148],
                    [-595, 144],
                    [-595, 141],
                    [-591, 136],
                    [-586, 133],
                    [-582, 141],
                    [-578, 130],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}
            };

            var scrubby_lake = {
                title: "some scrubby lake",
                world_coords: [
                    [547, 650],
                    [546, 652],
                    [545, 651],
                    [544, 650],
                    [544, 648],
                    [545, 647],
                    [547, 649],
                    [547, 650],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}

            };


            var oakwoods_outline = {
                world_coords: [
                    [-403, -83], 
                    [-424, -110], 
                    [-453, -146],
                    [-477, -176],
                    [-469, -181],
                    [-479, -190],
                    [-508, -185],
                    [-545, -199],
                    [-588, -201],
                    [-604, -187],
                    [-594, -185],
                    [-575, -140],
                    [-551, -115],
                    [-512, -106],
                    [-499, -127],
                ],
                fill: "none",
                stroke: {color: 'darkgreen', width: '1px'}
            };

            var boiling_lake_outline = {
                title: "Boiling Lake",
                world_coords: [
                    [160, 554],
                    [168, 562],
                    [168, 565],
                    [165, 575],
                    [159, 584],
                    [154, 584],
                    [154, 577],
                    [159, 573],
                    [157, 568],
                    [156, 563],
                    [160, 554],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}
            };

            var cypress_outline = {
                title: "Cypress Swamp",
                world_coords: [
                    [-15, 417],
                    [-32, 466],
                    [-63, 474],
                    [-97, 478],
                    [-126, 477],
                    [-196, 478],
                    [-218, 452],
                    [-214, 444],
                    [-203, 440],
                    [-209, 437],
                    [-213, 419],
                    [-210, 408],
                    [-221, 401],
                    [-200, 389],
                    [-195, 375],
                    [-193, 359],
                    [-206, 329],
                    [-185, 327],
                    [-177, 333],
                    [-172, 327],
                    [-154, 334],
                    [-140, 335],
                    [-135, 343],
                    [-127, 346],
                    [-119, 341],
                    [-79, 347],
                    [-58, 350],
                    [-31, 367],
                    [-17, 386],
                    [-15, 417],
                ],
                fill: "#eef9d9",
                stroke: {color: 'darkgreen', width: '1px'}
            };

            var another_cliff = {
                world_coords: [
                    [-649, 189],
                    [-655, 188],
                    [-679, 236],
                    [-686, 244],
                    [-687, 247],
                    [-694, 259],
                    [-695, 269],
                    [-698, 277],
                    [-693, 298],
                    [-685, 316],
                    [-687, 334],
                    [-670, 364],
                    [-663, 367],
                    [-658, 388],
                    [-651, 394],
                    [-654, 403],
                    [-669, 417],
                    [-672, 432],
                ],
                fill: "none",
                stroke: {color: 'gray', width: '1px'}
            };

            var cypress_lake = {
                title: "Cypress Lake",
                world_coords: [
                    [-68, 440],
                    [-80, 443],
                    [-77, 430],
                    [-86, 429],
                    [-96, 423],
                    [-101, 422],
                    [-103, 418],
                    [-103, 411],
                    [-116, 402],
                    [-121, 395],
                    [-118, 387],
                    [-119, 380],
                    [-128, 364],
                    [-128, 360],
                    [-139, 353],
                    [-144, 349],
                    [-149, 350],
                    [-152, 358],
                    [-141, 363],
                    [-129, 378],
                    [-128, 400],
                    [-131, 408],
                    [-120, 410],
                    [-110, 416],
                    [-106, 428],
                    [-102, 431],
                    [-95, 431],
                    [-68, 440],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}
            };

            var some_other_lake = {
                title: "Noname Lake",
                world_coords: [
                    [717, -651],
                    [714, -647],
                    [717, -645],
                    [717, -643],
                    [721, -641],
                    [721, -639],
                    [718, -637],
                    [722, -636],
                    [723, -632],
                    [721, -630],
                    [719, -631],
                    [717, -628],
                    [716, -628],
                    [713, -631],
                    [711, -639],
                    [712, -642],
                    [709, -645],
                    [707, -647],
                    [707, -650],
                    [711, -652],
                    [715, -653],
                    [717, -651],
                ],
                fill: "skyblue",
                stroke: {color: 'darkblue', width: '1px'}
            };

            var some_swampy = {
                world_coords: [
                    [-16, 418],
                    [-19, 409],
                    [-23, 407],
                    [-25, 405],
                    [-27, 409],
                    [-25, 414],
                    [-21, 417],
                    [-24, 420],
                    [-25, 416],
                    [-27, 418],
                    [-31, 418],
                    [-34, 415],
                ],
                fill: "none",
                stroke: {color: 'darkblue', width: '1px'}
            };

            var canyon_entrance1_route = {
                waypoints: [
                    [-589, -132],
                    [-627, -136],
                ],
                route: [
                    [-589, -132],
                    [-605, -122],
                    [-627, -136],
                    [-638, -124],
                    [-648, -122],

                ],
                waypointRadius: 5,
                waypointFill: "yellow",
                waypointStroke: {color: 'red', width: '1px'},
                routeStroke: {color: 'red', width: '1px', 'dasharray': '5,10'},
            };
            var canyon_entrance1_route2 = {
                waypoints: [
                ],
                route: [
                    [-627, -136],
                    [-630, -145],
                    [-645, -143],
                    [-674, -154],
                ],
                waypointRadius: 10,
                waypointFill: "yellow",
                waypointStroke: {color: 'red', width: '1px'},
                routeStroke: {color: 'red', width: '1px', 'dasharray': '5,10'},
            };


            var oakwoods_to_pinewoods = {
                waypoints: [
                    [-455, -193],
                    [-465, -174],
                ],
                route: [
                    [-455, -193],
                    [-457, -185],
                    [-465, -174],
                ],
                waypointRadius: 5,
                waypointFill: "yellow",
                waypointStroke: {color: 'red', width: '1px'},
                routeStroke: {color: 'red', width: '1px', 'dasharray': '2,3'},
            };

            var random_forest_edges = [
                [349, 498],
                [-695, 269],
                [608, -514],
                [-337, -212],
                [581, 431],
            ];

        </script>
        <script type='text/javascript'>
            var WIDTH = 1600;

            function world2raw(x, y) {
                if(Array.isArray(x)) {
                    y = x[1];
                    x = x[0];
                }
                return [WIDTH/2 - y, WIDTH/2 + x];
            }

            function raw2world(x, y) {
                if(Array.isArray(x)) {
                    y = x[1];
                    x = x[0];
                }
                return [-WIDTH/2 + y, WIDTH/2 - x];
            }


            function start() {
                if(SVG.supported) {
                    document.getElementById('badness').style.display = "none";
                }
                var svg = SVG('canvas1').size(WIDTH, WIDTH)
                var rect = svg.rect(WIDTH, WIDTH).attr({ fill: '#fff' });
                var rect = svg.rect(WIDTH, WIDTH).fill('none').stroke({color: '#000', width: '2px'});


                drawCompass(svg);
                drawPath(svg, crater);
                drawPath(svg, redwood_outline);
                drawPath(svg, oakwoods_outline);
                drawPath(svg, redwood_canyon_outline);
                drawPath(svg, redwood_canyon2_outline);
                drawPath(svg, boiling_lake_outline);
                drawPath(svg, some_other_lake);
                drawPath(svg, cypress_outline);
                drawPath(svg, some_swampy);
                drawPath(svg, scrubby_lake);
                drawPath(svg, cypress_lake);
                drawPath(svg, redwood_lake);
                drawPath(svg, redwood_cliff3);
                //drawCircle(svg, swamp_lake);
                drawPath(svg, swamp_lake2);
                drawPath(svg, big_lake);
                drawPath(svg, iits_lake_outline);
                drawPath(svg, iits_cliff);
                drawPath(svg, another_cliff);
                drawPath(svg, implied_canyontop);
                drawPath(svg, implied_canyontop2);
                drawCircle(svg, cactus_lake);
                drawRoute(svg, canyon_entrance1_route2);
                drawRoute(svg, canyon_entrance1_route);
                drawRoute(svg, box_canyon_route1);
                drawRoute(svg, box_canyon3);
                drawPath(svg, box_lake);
                drawRoute(svg, iits_route1);
                drawRoute(svg, cactus_to_canyon);
                drawRoute(svg, cactus_to_canyon2);
                drawRoute(svg, redwood_entrance4_route);
                drawRoute(svg, volcano_canyon1);
                drawRoute(svg, oakwoods_to_pinewoods);


                drawPath(svg, coast1);
                coast_points.forEach(function(pt) {
                    var xy, circle;
                    xy = world2raw(pt);
                    circle = svg.circle(5).center(xy[0], xy[1]).fill('darkblue');
                });
                random_forest_edges.forEach(function(pt) {
                    var xy, circle;
                    xy = world2raw(pt);
                    circle = svg.circle(5).center(xy[0], xy[1]).fill('green');
                });
                forage_plants.forEach(function(pt) {
                    var xy, circle;
                    xy = world2raw(pt);
                    circle = svg.circle(10).center(xy[0], xy[1]).fill('lightgreen').stroke({color: 'darkgreen'});
                });
                blue_plants.forEach(function(pt) {
                    var xy, circle;
                    xy = world2raw(pt);
                    circle = svg.circle(10).center(xy[0], xy[1]).fill('lightblue').stroke({color: 'darkgreen'});
                });

                /*

                xy = world2raw(0, 100);
                circle = svg.circle(10).center(xy[0], xy[1]).fill('red');

                xy = world2raw(0, 0);
                circle = svg.circle(10).center(xy[0], xy[1]).fill('#000');
                */

                var canvas = document.getElementById("canvas1");

                canvas.addEventListener('mousemove', onMouseMove);
            }

            function drawRoute(svg, route) {
                var routeCoords = route.route.map(world2raw);
                svg.polyline(routeCoords).stroke(route.routeStroke).fill('none');
                route.waypoints.forEach(function(waypoint) { 
                    var cpt = world2raw(waypoint);
                    var group = svg.group();
                    group.element('title').words("" + waypoint[0] + " " + waypoint[1]);
                    var circle = svg.circle(route.waypointRadius).center(cpt[0], cpt[1]).fill(route.waypointFill).stroke(route.waypointStroke);
                    group.put(circle);

                });
            }

            function drawPath(svg, obj) {
                var coords = obj.world_coords.map(world2raw);
                var group = svg.group();
                if(obj.title != null) {
                    group.element('title').words(obj.title);
                }

                var path = svg.polyline(coords).fill(obj.fill).stroke(obj.stroke);
                group.put(path);

            }

            function drawCircle(svg, obj) {
                var cpt = world2raw(obj.center);
                var group = svg.group();
                if('title' in obj && obj.title != null) {
                    group.element("title").words(obj.title);
                }
                var circle = svg.circle(obj.radius).center(cpt[0], cpt[1]).fill(obj.fill).stroke(obj.stroke);
                group.put(circle);
                //var title = svg.element('title').words('hi');
                //title.addTo(circle);
            }

            function drawCompass(svg) {
                var stroke1 = {color: '#000', width: '1px'};
                var radius = 160;
                var rect = svg.rect(radius, radius)
                    .fill('none')
                    .move(WIDTH-10-radius, 10)
                    .stroke(stroke1);
                var makeArrow = function() {
                    return svg.polyline([[0, 5],[5, 5],[2, 20], [0, 5]]).fill('none').stroke(stroke1);   
                }
                var cx = WIDTH-10-radius/2;
                var cy = 10 + radius/2;
                for(var i = 0; i < 360; i+=90) {
                    var arrow = makeArrow();
                    arrow.move(cx-2, cy+10).rotate(i, cx, cy);
                }
                circle = svg.circle(10).center(cx, cy).fill('red');

                var text = svg.plain("-X");
                text.center(cx, cy - 45);
                var text = svg.plain("dir: -180");
                text.center(cx, cy - 65);

                var text = svg.plain("+X");
                text.center(cx, cy + 45);
                var text = svg.plain("dir: 0");
                text.center(cx, cy + 65);
                
                var text = svg.plain("+Y");
                text.center(cx - 50, cy - 10);
                var text = svg.plain("dir: 90");
                text.center(cx - 50, cy + 10);

                var text = svg.plain("-Y");
                text.center(cx + 50, cy - 10);
                var text = svg.plain("dir: -90");
                text.center(cx + 50, cy + 10);

            }

            function pad(x) {
                var s = x + "";
                var n = s.length;
                for(var i = n; i<5; i++) {
                    s = "&nbsp;" + s;
                }
                return s;
            }

            function onMouseMove(_event) {
                var canvas = document.getElementById('canvas1');
                var origin = getOffsetTopLeft(canvas);
                var raw_x = _event.layerX - Math.floor(origin.left);
                var raw_y = _event.layerY - Math.floor(origin.top);
                var world_xy = raw2world(raw_x, raw_y);
                document.getElementById('xyreporter').innerHTML = "" + pad(world_xy[0]) + " " + pad(world_xy[1]);
            }

            function getOffsetTopLeft(elt) {
                // see http://javascript.info/tutorial/coordinates
                var box = elt.getBoundingClientRect()
                return { top: box.top + window.pageYOffset, left: box.left + window.pageXOffset};
            }
        </script>
	</head>
    <body onload='start()'>
        <pre id='badness'>No SVG for you!
        -- your browser
        </pre>
        <div id='xyreporter' class='coord-display'>
        </div>
        <div id='canvas1'>
        </div>
    </body>
</html>
